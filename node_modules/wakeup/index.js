var url = require('url'),
    exec = require('child_process').exec;

module.exports = function(req, res) {
    res.writeHead(200, {'Content-Type': 'text/plain'});

    if (url.parse(req.url, true).query.secret == 'secret') {
        console.log('Access Granted');
        res.write('Access Granted');

        exec('wakeonlan macaddr', function(error, stdout, stderr) {
            out = error ? stderr : stdout;
            res.write('\n'+out);
            res.end();
        });
    } else {
        console.log('Access Denied');
        res.write('Access Denied');
        res.end();
    }
};
